 
<!DOCTYPE html>
<html>
  <head>
    <title>Проект "Комменты"</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div class="container">
      <div class="list-loader"> Комментарии загружаются...</div> 
      <ul id="list" class="comments">
      </ul>
      <!--JS-->
      <div class="add-form">
        <input id="name-input" type="text" class="add-form-name" placeholder="Введите ваше имя" />
        <textarea id="text-input" type="textarea" class="add-form-text" placeholder="Введите ваш коментарий" rows="4"
        ></textarea>
        <div class="add-form-row">
          <button id="comment-button" class="add-form-button">Написать</button>
        </div>
      </div>
    </div>
  </body>
  <style>
    .error {
      background-color: red;
    };

  </style>


<script>
  "use strict";
  // Код писать здесь
  const addCommentButton = document.getElementById("comment-button");
  const addComment = document.getElementById("list");
  const nameInput = document.getElementById("name-input");
  const textInput = document.getElementById("text-input");
  const currentDate = new Date().toLocaleDateString('ru-RU', {year: '2-digit', month: '2-digit',  day: '2-digit', hour: '2-digit', minute: '2-digit', hour12: false,
      }).replace(',','');


  let comments = [];

  function getComments() {
    
    return fetch("https://wedev-api.sky.pro/api/v1/Aleksandra1216/comments", {
      method: "GET",
    })
      .then((response) => response.json())
      .then((responseData) => {
        const appComments = responseData.comments.map((comment) => {
          return {
            name: comment.author.name,
            text: comment.text,
             date: currentDate,
            //date: new Date (comment.date),
            isLike: comment.likes,
            isLiked: false,
          };
        });
        comments = appComments;
        renderComments();
      
  })
}
getComments();

  const renderComments = () => {
    const commentsHtml = comments
      .map((comment, index) => {
        return `<li class="comment">
          <div class="comment-header">
            <div>${comment.name}</div>
            <div>${comment.date}</div>
          </div>
          <div class="comment-body">
            <div class="comment-text" data-index="${index}">
              ${comment.text}
            </div>
          </div>
          <div class="comment-footer">
            <div class="likes">
              <span class="likes-counter">${comment.isLike}</span>
              <button class="like-button ${
                comment.isLiked ? "-active-like" : ""
              }" data-index="${index}"></button>
            </div>
          </div>
        </li>`;
      })
      .join("");
    addComment.innerHTML = commentsHtml;

    const commentsElements = document.querySelectorAll(".comment-text");
    for (const commentElement of commentsElements) {
      commentElement.addEventListener("click", () => {
        const index = commentElement.dataset.index;
        if (index !== null) {
          const comment = comments[index];
          textInput.value = `> ${comment.name} : ${comment.text}`;
        }
      });
    }

    const likeButtons = document.querySelectorAll(".like-button");
    for (const likeButton of likeButtons) {
      likeButton.addEventListener("click", () => {
        const index = likeButton.dataset.index;
        if (index !== null) {
          const comment = comments[index];
          if (!comment.isLiked) {
            comment.isLiked = true;
            comment.isLike++;
          } else {
            comment.isLiked = false;
            comment.isLike--;
          }
          renderComments();
        }
      });
    }
  };
  

  addCommentButton.addEventListener("click", () => {
    nameInput.classList.remove("error");
    textInput.classList.remove("error");
    if (nameInput.value === "" && textInput.value === "") {
      nameInput.classList.add("error");
      textInput.classList.add("error");
      return;
    } else if (nameInput.value === "") {
      nameInput.classList.add("error");
      return;
    } else if (textInput.value === "") {
      textInput.classList.add("error");
      return;
    }

    const startAt = Date.now();
    console.log('Начинаем делать запрос');
    addCommentButton.disabled = true;
    addCommentButton.textContent = 'Элемент добавляется...';


    fetch("https://wedev-api.sky.pro/api/v1/Aleksandra1216/comments", {
      method: "POST",
      body: JSON.stringify({
        name: nameInput.value
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;"),
        date: currentDate,
        text: textInput.value
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("QUOTE_BEGIN", "<div class='comment-quote'><b>")
         .replaceAll("QUOTE_END", "</b></div>"),
      }),
    })
    .then((response) => {
      console.log("Время:" + (Date.now() - startAt));
      return response;
    })
    .then((response) => {
      return response.json();
    })
    .then((response) => {
      console.log("Время:" + (Date.now() - startAt));
      return response;
    })
    .then(() => {
      return getComments();
    })
    
    .then(() => {
    addCommentButton.disabled = false;
    addCommentButton.textContent = 'Добавить';
    })
      
        getComments();
    nameInput.value = "";
    textInput.value = "";
  });
  

</script>
</html>